\AtEndOfPackage{%
\let\bookmark\@gobble
\ifx\Acrobatmenu\@gobble
\else
\def\@writetorep#1#2#3{%
\ifx\WriteBookmarks\relax\else
    \@tempcnta#3
    \expandafter\edef\csname Parent#3\endcsname{#2}%
    \advance\@tempcnta by -1
    \protected@write\@outlinefile%
       {\let~\space
\let\mbox\@firstofone
\let\em\@empty
\def\axiom{AXIOM\@firstofone}%
\def\asharp{Aldor\@firstofone}%
\def\xasharp{XAXIOM-XL\@firstofone}%
\let\@mkboth \@gobbletwo
\let\textit\@firstofone
\let\textem\@firstofone
        \let\label\@gobble
        \let\index\@gobble
        \let\glossary\@gobble}%
       {%
     \protect\BOOKMARK{#2}{#1}{\csname Parent\the\@tempcnta\endcsname}}%
\fi
}
\def\old@part[#1]#2{%
 \H@old@part [{#1}]{#2}%
 \@writetorep {#1}{part.\theHpart }{-1}}
\let\old@widesection\widesection
\def\widesection#1{%
  \old@widesection{#1}%
  \@writetorep{#1}{section.\thesection}{1}}%
\let\@ld@section\section
\def\section#1{%
  \@ld@section{#1}%
  \@writetorep{#1}{section.\thesection}{1}}%
\let\@ld@theindex\theindex
\def\theindex{%
  \@ld@theindex
  \bookmark{Index}}%
\newcount\bcount
\def\bookmark#1{%
  \global\advance\bcount\@ne
  \hyper@@anchor{xxx.\the\bcount}{\relax}%
  \@writetorep{#1}{xxx.\the\bcount}{-1}}%
\fi
}

