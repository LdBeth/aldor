# ..From autoconf
@SET_MAKE@

VPATH = @srcdir@
abs_top_builddir = @abs_top_builddir@
srcdir = @srcdir@
top_builddir = @top_builddir@
builddir = @builddir@
abs_top_srcdir = @abs_top_srcdir@
subdir = aldor/test

.PRECIOUS: Makefile
Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	@case '$?' in \
	  *config.status*) \
	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
	  *) \
	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ '; \
	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ ;; \
	esac;

aldorexedir = $(abs_top_builddir)/aldor/src
foamlibdir = $(abs_top_builddir)/aldor/lib/libfoamlib

tests=simple_j rectest

simple_j_AXLFLAGS=-Q2

$(patsubst %, %.fm, $(tests)): %.fm: %.ao
	 $(aldorexedir)/aldor -Nfile=$(aldorexedir)/aldor.conf -Ffm=$(builddir)/$@ $<	

$(patsubst %, %.java, $(tests)): %.java: %.fm $(aldorexedir)/javagen
	 $(aldorexedir)/javagen $< > $@

define aldor_args
	-Nfile=$(aldorexedir)/aldor.conf 	\
	-Y$(foamlibdir)/al			\
	-I$(foamlibdir)			\
	-lAxlLib=foamlib 		\
	$(AXLFLAGS) $($*_AXLFLAGS)	\
	-Fao=$*.ao $(srcdir)/$*.as
endef

java: $(patsubst %,%.java,$(tests))
$(patsubst %, %.ao, $(tests)): %.ao: %.as
	$(aldorexedir)/aldor $(aldor_args)

javaopts=-cp $(abs_top_builddir)/aldor/lib/java/build/foamj.jar

$(patsubst %, %.class, $(tests)): %.class: %.java
	javac $(javaopts) $<

class: $(patsubst %, %.class, $(tests))

all: java class

.PHONY: all java


